const { updateOrCreateUserWithUid } = require('../controllers/users');

const botHearsMyLink = async (ctx) => {
  const {
    update: {
      message: {
        from: { first_name, last_name, id },
      },
    },
  } = ctx;
  let link = `https://t.me/whatisinyourmind_bot?start=${id}`;
  let message = `Ø³Ù„Ø§Ù… ${first_name + ' ' + last_name} Ù‡Ø³ØªÙ… ğŸ˜Š \n 
Ø±ÙˆÛŒ Ù„ÛŒÙ†Ú© Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù† Ùˆ Ù‡Ø± Ø§Ù†ØªÙ‚Ø§Ø¯ÛŒ Ú©Ù‡ Ù†Ø³Ø¨Øª Ø¨Ù‡ Ù…Ù† Ø¯Ø§Ø±ÛŒ ÛŒØ§ Ø§Ø¹ØªØ±Ø§Ù Ùˆ Ø­Ø±ÙÛŒ Ú©Ù‡ ØªÙˆ Ø¯Ù„Øª Ù‡Ø³Øª Ø±Ùˆ Ø¨Ø§ Ø®ÛŒØ§Ù„ Ø±Ø§Ø­Øª Ø¨Ù†ÙˆÛŒØ³ Ùˆ Ø¨ÙØ±Ø³Øª. Ø¨Ø¯ÙˆÙ† Ø§ÛŒÙ†Ú©Ù‡ Ø§Ø² Ø§Ø³Ù…Øª Ø¨Ø§Ø®Ø¨Ø± Ø¨Ø´Ù… Ù…ØªÙ†Øª Ø¨Ù‡ Ù…Ù† Ù…ÛŒâ€ŒØ±Ø³Ù‡. Ø®ÙˆØ¯ØªÙ… Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒ Ùˆ Ø§Ø² Ù‡Ù…Ù‡ Ø¨Ø®ÙˆØ§ÛŒ Ø±Ø§Ø­Øª Ùˆ Ù†Ø§Ø´Ù†Ø§Ø³ Ø¨Ù‡Øª Ù¾ÛŒØ§Ù… Ø¨ÙØ±Ø³ØªÙ†ØŒ Ø­Ø±ÙØ§ÛŒ Ø®ÛŒÙ„ÛŒ Ø¬Ø§Ù„Ø¨ÛŒ Ù…ÛŒØ´Ù†ÙˆÛŒ.
   \n 
   âœ” ${link} âœ”
     `;

  let { status } = await updateOrCreateUserWithUid(id, {
    first_name,
    last_name,
  });

  if (status && status === 'success') {
    ctx.reply(message);
    ctx.reply(
      'Ù¾ÛŒØ§Ù… Ø¨Ø§Ù„Ø§ Ø±Ùˆ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ³ØªØ§Øª Ø¨ÙØ±Ø³Øª ØªØ§ Ø¨ØªÙˆÙ†Ù† Ø¨Ù‡Øª Ù¾ÛŒØ§Ù… Ù†Ø§Ø´Ù†Ø§Ø³ Ø¨Ø¯Ù† ğŸ‘†ğŸ‘†'
    );
  }
};

module.exports = botHearsMyLink;
